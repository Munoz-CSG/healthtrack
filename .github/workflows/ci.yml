name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # Clona el repositorio
      - name: Checkout del c√≥digo
        uses: actions/checkout@v3

      # Configura Java 17
      - name: Configurar Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # Ejecuta pruebas unitarias y funcionales con Maven
      - name: Ejecutar pruebas con Maven
        run: mvn clean test

      # Publica los reportes Surefire (JUnit)
      - name: Subir artefactos Surefire
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: surefire-reports
          path: target/surefire-reports/

      # Publica logs de pruebas Selenium
      - name: Subir logs de Selenium
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: selenium-logs
          path: selenium-tests/logs/

      # Ejecuta pruebas de rendimiento con JMeter
      - name: Ejecutar JMeter (performance test)
        run: |
          mkdir -p jmeter/reporte-html
          jmeter -n -t jmeter/ActualizarPesoPerformance.jmx -l jmeter/resultados.jtl -e -o jmeter/reporte-html

      # Publica el reporte de JMeter
      - name: Subir reporte de JMeter
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: jmeter-report
          path: jmeter/reporte-html/
